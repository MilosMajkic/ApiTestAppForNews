// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  passwordHash  String
  plan          String    @default("FREE") // "FREE", "PREMIUM", "TEAM"
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  preferences   UserPreferences?
  favorites     Favorite[]
  collections   Collection[]
  aiSummaries   AISummary[]
  interactions  UserInteraction[]
}

model UserPreferences {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  topics        String   @default("[]") // JSON string: ["technology", "business", ...]
  sources       String   @default("[]") // JSON string: ["source1", "source2", ...]
  region        String?
  language      String   @default("en")
  darkMode      Boolean  @default(false)
  autoDarkMode  Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Favorite {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  articleId   String   // External article ID
  title       String
  description String?
  url         String
  imageUrl    String?
  source      String
  publishedAt DateTime
  savedAt     DateTime @default(now())
  
  @@index([userId])
  @@index([articleId])
}

model Collection {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  description String?
  articles    CollectionArticle[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
}

model CollectionArticle {
  id           String    @id @default(cuid())
  collectionId String
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  articleId    String
  title        String
  description  String?
  url          String
  imageUrl     String?
  source       String
  publishedAt  DateTime
  addedAt      DateTime  @default(now())
  
  @@index([collectionId])
  @@index([articleId])
}

model AISummary {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  articleId   String
  summary     String
  createdAt   DateTime @default(now())
  
  @@unique([userId, articleId])
  @@index([userId])
  @@index([articleId])
}

model UserInteraction {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  articleId   String
  action      String   // "viewed", "saved", "skipped", "read"
  topic       String?
  source      String?
  timestamp   DateTime  @default(now())
  
  @@index([userId])
  @@index([articleId])
  @@index([timestamp])
}

// Plan enum removed - SQL Server doesn't support enums
// Using String with values: "FREE", "PREMIUM", "TEAM"

